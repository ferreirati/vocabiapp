
<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">Vocabi app</a></li>
    <li class="breadcrumb-item"><a href="/"><%= @words.first.pos.pluralize(2).capitalize %></a></li>
    <li class="breadcrumb-item active" aria-current="page">Level <%= (@words.first.level + 1).to_i %></li>
  </ol>
</nav>

<div id="questions">
  <nav aria-label="Question numbers" class="py-3">
    <ul class="pagination justify-content-between">
      <% (1..10).each do |i| %>
      <li class="page-item">
        <a class="page-link"
           data-toggle="collapse"
           href="#question-<%= i %>"
           <%= 'aria-expanded=true' if i.eql?(1) %>>
          <%= i %></a>
      </li>
      <% end %>
    </ul>
  </nav>

  <% (1..10).each_with_index do |i| %>
  <div class="card collapse<%= ' show' if i.eql?(1) %>"
       id="question-<%= i %>"
       data-parent="#questions" >
    <div class="card-body">
      <div class="spinner-border text-primary" role="status"><span class="sr-only">Loading...</span></div>
      <div class="feedback">
        <%= image_tag('check-solid.svg', alt: 'correct svg', class: 'correct-svg')%>
        <%= image_tag('times-solid.svg', alt: 'wrong svg', class: 'wrong-svg')%>
      </div>
      <div class="text-center mb-5 word">
        <%= @words[i][(current_user&.target || 'en').to_sym] %>
      </div>
      <div class="d-flex justify-content-around flex-wrap">
      <% answers_array(i).each do |option| %>
        <button class="btn btn-sm btn-info mb-1 <%= 'correct-answer' if option.eql?(i) %>"
                data-word-id="<%= @words[option].id %>">
          <%= @words[option][(current_user&.source || 'es').to_sym] %>
        </button>
      <% end %>
      </div>
    </div>
  </div>
  <% end %>
</div>

<script>
  $(document).ready(function() {
    $('div.spinner-border, img.correct-svg, img.wrong-svg').hide();

    // CHOOSE ANSWER
    $('.card-body button').click((ev) => {
      $(ev.target).siblings().attr('disabled', true);
      $('div.spinner-border').show();
      $(ev.target).addClass('chosen');

      let correct = $(ev.target).hasClass('correct-answer');
      $.post("/answers", {
        source: '<%= current_user&.source || 'es' %>',
        target: '<%= current_user&.target || 'en' %>',
        word_id: $(ev.target).data('word-id'),
        correct: correct
      }, () => {
        $('div.spinner-border').hide();
        let feedbackIcon = 'img.' + (correct ? 'correct-svg' : 'wrong-svg');
        $(ev.target).parents('div.card-body').find(feedbackIcon).show();
      });
    });
  });
</script>